{% extends "base.html" %}
{% block title %}{{ collection.name }} — Collection{% endblock %}

{% block content %}
<div class="py-10 max-w-6xl mx-auto">

    <div class="flex justify-between items-center mb-8">
        <h1 class="text-4xl font-bold">{{ collection.name }}</h1>

        <form action="{{ url_for('remove_from_collection', col_id=collection.id, book_id=0) }}"
              method="POST" onsubmit="return false;">
            <!-- Placeholder – we remove books per-card -->
        </form>
    </div>

    {% if collection.books %}
        <div id="collectionGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
            {% for book in collection.books %}
                <div class="relative group p-4 backdrop-blur-md bg-white/70 dark:bg-gray-800/70 
                            rounded-xl shadow-md hover:shadow-xl transition" data-book-id="{{ book.id }}">

                    <!-- Cover -->
                    <a href="{{ url_for('book_detail', book_id=book.id) }}"
                       class="w-36 aspect-[2/3] overflow-hidden rounded shadow mx-auto block cursor-pointer">
                        <img src="{{ book.cover_url }}" class="w-full h-full object-cover" alt="Cover of {{ book.title }}">
                    </a>

                    <!-- Title -->
                    <h2 class="mt-3 text-lg font-bold text-center line-clamp-2">{{ book.title }}</h2>

                    <!-- Remove from collection -->
                    <form action="{{ url_for('remove_from_collection', col_id=collection.id, book_id=book.id) }}"
                          method="POST" class="absolute top-3 right-3 z-20">
                        <button type="submit"
                            aria-label="Remove from collection"
                            class="w-7 h-7 flex items-center justify-center rounded-full bg-red-500/80 text-white shadow hover:scale-110 transition">
                            ✕
                        </button>
                    </form>

                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-gray-600 dark:text-gray-300 text-lg">
            This collection is empty.
        </p>
    {% endif %}

</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const grid = document.getElementById("collectionGrid");

    if (!grid) return;

    new Sortable(grid, {
        animation: 150,
        ghostClass: "opacity-40",
        onEnd: function () {
            const order = [...document.querySelectorAll("[data-book-id]")].map(
                el => el.dataset.bookId
            );

            fetch("/update-order", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ order })
            });
        }
    });
});
</script>

{% endblock %}