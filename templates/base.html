<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Bookshelf{% endblock %}</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {            
            corePlugins: {
                preflight: false
            }
        }
    </script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600&display=swap" rel="stylesheet">
</head>

<body class="
    text-gray-900 transition-colors duration-300
    {% if current_user.is_authenticated %}
        theme-{{ current_user.theme }}
    {% endif %}
">
    <!-- ðŸŒ¿ FIXED BACKGROUND LAYER (our custom effects live here!) -->
    <div id="spring-background"
    class="
        {% if current_user.is_authenticated %}
            {% if current_user.theme == 'spring' %} spring-theme {% endif %}
            {% if current_user.theme == 'midnight' %} midnight-theme {% endif %}
            {% if current_user.theme == 'fireplace' %} fireplace-theme {% endif %}       
        {% else %}
            spring-theme
        {% endif %}
    ">
            <!-- ðŸŒ¿ CONTENT ABOVE BACKGROUND -->
        <div id="content" class="relative z-10">

            <!-- Navbar -->
            <nav class="shadow mb-8 transition-colors duration-300">
                <div class="max-w-5xl mx-auto px-4 py-4 flex justify-between items-center">
                    <a href="/" class="text-2xl font-semibold no-underline text-inherit">ðŸ“š Bookshelf</a>
                    <div class="space-x-4">
                        {% if current_user.is_authenticated %}
                            <a href="/library" class="no-underline">Library</a>
                            <a href="/collections" class="no-underline">Collections</a>
                            <a href="/quotes" class="no-underline">Quotes</a>
                            <a href="/themes" class="no-underline">Themes</a>
                            <a href="/profile" class="no-underline">Profile</a>
                            <a href="/logout" class="no-underline">Logout</a>
                        {% else %}
                            <a href="/login" class="no-underline">Login</a>
                            <a href="/register" class="no-underline">Register</a>
                        {% endif %}                        
                    </div>
                </div>
            </nav>

            <!-- Page content -->
            <main class="max-w-5xl mx-auto px-4">
                {% block content %}{% endblock %}
            </main>

            <!-- Global Delete Confirmation Modal -->
            <div id="confirmDeleteModal"
                class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden justify-center items-center z-[1000]">

                <div class="bg-white rounded-lg p-6 shadow-xl w-80">
                    <h2 name="globalDelete" class="text-xl font-semibold mb-4">Confirm Deletion</h2>

                    <p name="globalDelete" id="deleteMessage" class="text-gray-700 mb-4">
                        Are you sure you want to delete this?
                    </p>

                    <form id="deleteForm" method="POST">
                        <div class="flex justify-end gap-3">
                            <button name="deleteModal" type="button"
                                    onclick="closeDeleteModal()"
                                    class="btn rounded-lg">
                                Cancel
                            </button>

                            <button name="deleteModal" type="button"
                                    class="btn rounded-lg"
                                    onclick="document.getElementById('deleteForm').submit()">
                                Delete
                            </button>
                        </div>
                    </form>
                </div>
            </div>

        </div>
        
    </div> 
    
    <!-- SortableJS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

    <script>
    function openDeleteModal(message, actionUrl) {
        document.getElementById("deleteMessage").textContent = message;
        const form = document.getElementById("deleteForm");
        form.action = actionUrl;

        const modal = document.getElementById("confirmDeleteModal");
        modal.classList.remove("hidden");
        modal.classList.add("flex");
    }

    function closeDeleteModal() {
        const modal = document.getElementById("confirmDeleteModal");
        modal.classList.add("hidden");
        modal.classList.remove("flex");
    }

    document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll("[data-delete-url]").forEach(btn => {
            btn.addEventListener("click", () => {
                const url = btn.dataset.deleteUrl;
                const message = btn.dataset.deleteMessage || "Delete this item?";
                openDeleteModal(message, url);
            });
        });
    });
    </script>

    <script>
    document.addEventListener("DOMContentLoaded", () => {

        document.querySelectorAll("form").forEach(form => {
            form.setAttribute("novalidate", "true");  // disable browser bubbles
            
            form.addEventListener("submit", (e) => {
                let firstInvalid = form.querySelector(":invalid");
                if (!firstInvalid) return; // all good

                e.preventDefault(); // STOP submit

                // remove old error if exists
                let old = firstInvalid.parentElement.querySelector(".input-error");
                if (old) old.remove();

                // create soft message
                let msg = document.createElement("div");
                msg.className = "input-error";
                msg.textContent = "Please fill out this field.";
                firstInvalid.parentElement.appendChild(msg);

                // focus field
                firstInvalid.focus();
            });

            form.querySelectorAll("input[required]").forEach(input => {
                input.addEventListener("input", () => {
                    // remove error when user types
                    let err = input.parentElement.querySelector(".input-error");
                    if (err) err.remove();
                });
            });
        });

    });
    </script>
</body>
</html>